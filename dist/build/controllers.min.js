/*! hospital application 2013-12-12 */
define(["angular","jquery","alertify","bootstrap","functional","services"],function(a,b,c,d,e){"use strict";a.module("hospitalControllers",["hospitalServices"]).controller("Login",["$scope","$location","LoginService",function(a,b,d){a.signin={username:"",password:"",remember:!1},a.login=function(){var e=new d;e.$save({username:a.signin.username,password:a.signin.password},function(a){if("true"==a.validUser){{a.role}b.path("/home")}else c.log("Wrong username or password")},function(){c.error("Server down, try again later")})}}]).controller("CreateAccount",["$scope","$location","CreateAccountService",function(a,b,d){a.signup={firstName:"",lastName:"",username:"",password:"",confirmation:"",error:!1,passwordIdentical:!0},a.change=function(){a.signup.passwordIdentical=a.signup.password==a.signup.confirmation,a.signup.error=!a.signup.passwordIdentical},a.createAccount=function(){if(!a.signup.error){var e=new d;e.$save({type:"CreateAccount",firstName:a.signup.firstName,lastName:a.signup.lastName,username:a.signup.username,password:a.signup.password},function(a){"true"==a.success?(c.success("Account successfully created"),b.path("/login")):c.error("This account has been registered")},function(){c.error("Server down, try again later")})}}}]).controller("Home",["$scope","$location","WebSocketService",function(a){a.sharedTemplate={url:"partials/main.html"},a.changeTemplateUrl=function(b){a.sharedTemplate.url="partials/"+b}}]).controller("DoctorController",["$scope","$location","WebSocketService",function(b,d,f){var g=15;b.noElements=0,b.doctors=[],b.query="",b.new={name:"",address:"",phone_number:"",working_hour:"",specialist:"",notice:"",reset:function(){for(var a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&(this[a]="")}},b.current={id:-1,name:"",address:"",phone_number:"",working_hour:"",specialist:"",notice:""},f.registerCallBack(function(a){var c=JSON.parse(a);if("doctor_handler"==c.type)switch(c.method){case"query":b.noElements=c.noElements,b.doctors=c.elements;break;case"create":b.doctors.unshift(c.elements[0]);break;case"update":!function(){var a=b.doctors.filter(function(a){return a.id==c.elements[0].id})[0];a&&e.simpleExtend(a,c.elements[0])}();break;case"filter":b.noElements=c.noElements,b.doctors=c.elements;break;case"delete":!function(){var a=e.findIndexByKeyValue(b.doctors,"id",c.elements[0].id);b.doctors.splice(a,1)}()}b.$apply()}),b.toggleEdit=function(c){e.simpleExtend(b.current,b.doctors.filter(function(a){return a.id==c})[0]),a.element("#edit-modal").modal("toggle")},b.toggleCreate=function(){b.new.reset(),a.element("#create-modal").modal("toggle")},b.create=function(){f.send({type:"doctor_handler",method:"create",elements:[{name:b.new.name,address:b.new.address,phone_number:b.new.phone_number,working_hour:b.new.working_hour,specialist:b.new.specialist,notice:b.new.notice}]}),a.element("#create-modal").modal("toggle")},b.update=function(c){e.simpleCompare(b.current,b.doctors.filter(function(a){return a.id==c})[0])||f.send({type:"doctor_handler",method:"update",elements:[b.current]}),a.element("#edit-modal").modal("toggle")},b.delete=function(a){c.confirm("Delete this row ?",function(b){b&&f.send({type:"doctor_handler",method:"delete",elements:[{id:a}]})})},b.filter=function(){f.send({type:"doctor_handler",method:"filter",page:1,max:g,keyword:b.query})},b.toPage=function(a){f.send({type:"doctor_handler",method:""==b.query?"query":"filter",page:a,max:g,keyword:b.query})},f.send({type:"doctor_handler",method:"query",page:1,max:g})}]).controller("PatientController",["$scope","$location","WebSocketService",function(b,d,f){var g=15;b.noElements=0,b.patients=[],b.query="",b.new={name:"",age:"",gender:"",address:"",phone_number:"",reset:function(){for(var a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&(this[a]="")}},b.current={id:-1,name:"",age:"",gender:"",address:"",phone_number:""},f.registerCallBack(function(a){var c=JSON.parse(a);if("patient_handler"==c.type)switch(c.method){case"query":b.noElements=c.noElements,b.patients=c.elements;break;case"create":b.patients.unshift(c.elements[0]);break;case"update":!function(){var a=b.patients.filter(function(a){return a.id==c.elements[0].id})[0];a&&e.simpleExtend(a,c.elements[0])}();break;case"filter":b.noElements=c.noElements,b.patients=c.elements;break;case"delete":!function(){var a=e.findIndexByKeyValue(b.patients,"id",c.elements[0].id);b.patients.splice(a,1)}()}b.$apply()}),b.toggleEdit=function(c){e.simpleExtend(b.current,b.patients.filter(function(a){return a.id==c})[0]),a.element("#edit-modal").modal("toggle")},b.toggleCreate=function(){b.new.reset(),a.element("#create-modal").modal("toggle")},b.create=function(){isNaN(b.new.age)?c.error("Invalid submission form!"):f.send({type:"patient_handler",method:"create",elements:[{name:b.new.name,age:b.new.age,gender:b.new.gender,address:b.new.address,phone_number:b.new.phone_number}]}),a.element("#create-modal").modal("toggle")},b.update=function(c){e.simpleCompare(b.current,b.patients.filter(function(a){return a.id==c})[0])||f.send({type:"patient_handler",method:"update",elements:[b.current]}),a.element("#edit-modal").modal("toggle")},b.delete=function(a){c.confirm("Delete this row ?",function(b){b&&f.send({type:"patient_handler",method:"delete",elements:[{id:a}]})})},b.filter=function(){f.send({type:"patient_handler",method:"filter",page:1,max:g,keyword:b.query})},b.toPage=function(a){f.send({type:"patient_handler",method:""==b.query?"query":"filter",page:a,max:g,keyword:b.query})},f.send({type:"patient_handler",method:"query",page:1,max:g})}]).controller("ICDController",["$scope","$location","WebSocketService",function(b,d,f){var g=15;b.noElements=0,b.icds=[],b.query="",b.new={name:"",code:"",reset:function(){for(var a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&(this[a]="")}},b.current={id:-1,name:"",code:""},f.registerCallBack(function(a){var c=JSON.parse(a);if("icd_handler"==c.type)switch(c.method){case"query":b.noElements=c.noElements,b.icds=c.elements;break;case"create":b.icds.unshift(c.elements[0]);break;case"update":!function(){var a=b.icds.filter(function(a){return a.id==c.elements[0].id})[0];a&&e.simpleExtend(a,c.elements[0])}();break;case"filter":b.noElements=c.noElements,b.icds=c.elements;break;case"delete":!function(){var a=e.findIndexByKeyValue(b.icds,"id",c.elements[0].id);b.icds.splice(a,1)}()}b.$apply()}),b.toggleEdit=function(c){e.simpleExtend(b.current,b.icds.filter(function(a){return a.id==c})[0]),a.element("#edit-modal").modal("toggle")},b.toggleCreate=function(){b.new.reset(),a.element("#create-modal").modal("toggle")},b.create=function(){f.send({type:"icd_handler",method:"create",elements:[{name:b.new.name,code:b.new.code}]}),a.element("#create-modal").modal("toggle")},b.update=function(c){e.simpleCompare(b.current,b.icds.filter(function(a){return a.id==c})[0])||f.send({type:"icd_handler",method:"update",elements:[b.current]}),a.element("#edit-modal").modal("toggle")},b.delete=function(a){c.confirm("Delete this row ?",function(b){b&&f.send({type:"icd_handler",method:"delete",elements:[{id:a}]})})},b.filter=function(){f.send({type:"icd_handler",method:"filter",page:1,max:g,keyword:b.query})},b.toPage=function(a){f.send({type:"icd_handler",method:""==b.query?"query":"filter",page:a,max:g,keyword:b.query})},f.send({type:"icd_handler",method:"query",page:1,max:g})}]).controller("DrugController",["$scope","$location","WebSocketService",function(b,d,f){var g=15;b.noElements=0,b.drugs=[],b.query="",b.new={name:"",unit:"",price:"",reset:function(){for(var a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&(this[a]="")}},b.current={id:-1,name:"",unit:"",price:""},f.registerCallBack(function(a){var c=JSON.parse(a);if("drug_handler"==c.type)switch(c.method){case"query":b.noElements=c.noElements,b.drugs=c.elements;break;case"create":b.drugs.unshift(c.elements[0]);break;case"update":!function(){var a=b.drugs.filter(function(a){return a.id==c.elements[0].id})[0];a&&e.simpleExtend(a,c.elements[0])}();break;case"filter":b.noElements=c.noElements,b.drugs=c.elements;break;case"delete":!function(){var a=e.findIndexByKeyValue(b.drugs,"id",c.elements[0].id);b.drugs.splice(a,1)}()}b.$apply()}),b.toggleEdit=function(c){e.simpleExtend(b.current,b.drugs.filter(function(a){return a.id==c})[0]),a.element("#edit-modal").modal("toggle")},b.toggleCreate=function(){b.new.reset(),a.element("#create-modal").modal("toggle")},b.create=function(){isNaN(b.new.price)?c.error("Invalid submission form!"):f.send({type:"drug_handler",method:"create",elements:[{name:b.new.name,unit:b.new.unit,price:b.new.price}]}),a.element("#create-modal").modal("toggle")},b.update=function(c){e.simpleCompare(b.current,b.drugs.filter(function(a){return a.id==c})[0])||f.send({type:"drug_handler",method:"update",elements:[b.current]}),a.element("#edit-modal").modal("toggle")},b.delete=function(a){c.confirm("Delete this row ?",function(b){b&&f.send({type:"drug_handler",method:"delete",elements:[{id:a}]})})},b.filter=function(){f.send({type:"drug_handler",method:"filter",page:1,max:g,keyword:b.query})},b.toPage=function(a){f.send({type:"drug_handler",method:""==b.query?"query":"filter",page:a,max:g,keyword:b.query})},f.send({type:"drug_handler",method:"query",page:1,max:g})}]).controller("MedicalServiceController",["$scope","$location","WebSocketService",function(b,d,f){var g=15;b.noElements=0,b.medicalServices=[],b.query="",b.new={name:"",unit:"",price:"",reset:function(){for(var a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&(this[a]="")}},b.current={id:-1,name:"",unit:"",price:""},f.registerCallBack(function(a){var c=JSON.parse(a);if("medical_service_handler"==c.type)switch(c.method){case"query":b.noElements=c.noElements,b.medicalServices=c.elements;break;case"create":b.medicalServices.unshift(c.elements[0]);break;case"update":!function(){var a=b.medicalServices.filter(function(a){return a.id==c.elements[0].id})[0];a&&e.simpleExtend(a,c.elements[0])}();break;case"filter":b.noElements=c.noElements,b.medicalServices=c.elements;break;case"delete":!function(){var a=e.findIndexByKeyValue(b.medicalServices,"id",c.elements[0].id);b.medicalServices.splice(a,1)}()}b.$apply()}),b.toggleEdit=function(c){e.simpleExtend(b.current,b.medicalServices.filter(function(a){return a.id==c})[0]),a.element("#edit-modal").modal("toggle")},b.toggleCreate=function(){b.new.reset(),a.element("#create-modal").modal("toggle")},b.create=function(){isNaN(b.new.price)?c.error("Invalid submission form!"):f.send({type:"medical_service_handler",method:"create",elements:[{name:b.new.name,unit:b.new.unit,price:b.new.price}]}),a.element("#create-modal").modal("toggle")},b.update=function(c){e.simpleCompare(b.current,b.medicalServices.filter(function(a){return a.id==c})[0])||f.send({type:"medical_service_handler",method:"update",elements:[b.current]}),a.element("#edit-modal").modal("toggle")},b.delete=function(a){c.confirm("Delete this row ?",function(b){b&&f.send({type:"medical_service_handler",method:"delete",elements:[{id:a}]})})},b.filter=function(){f.send({type:"medical_service_handler",method:"filter",page:1,max:g,keyword:b.query})},b.toPage=function(a){f.send({type:"medical_service_handler",method:""==b.query?"query":"filter",page:a,max:g,keyword:b.query})},f.send({type:"medical_service_handler",method:"query",page:1,max:g})}]).controller("MedicalHistoryController",["$scope","$location","$q","WebSocketService",function(b,d,e,f){function g(a,b,c){for(var d in b)typeof b[d]==c&&(b[d]=a)}function h(a,b){var c={};for(var d in a)typeof a[d]==b&&(c[d]=a[d]);return c}function i(a,b,c){return f.send({type:"medical_history_handler",method:a,value:b}),c.promise}var j=15;a.element("input[name='datepicker']").datepicker().on("changeDate",function(a){b.$apply(function(){b.create.visit_date=a.currentTarget.value})}),b.medicalHistories=[],b.noElements=0,b.create={toggle:!1,visit_date:"",outcome:"",patient_id:"",patient_name:"",icd:{code:"",id:""},prescriptions:{doctor_id:"",doctor_name:"",data:[],"new":{show:!1,drug_id:"",drug_name:"",quantity:"",dose:"",notice:"",toggleShow:function(){this.show=!this.show},reset:function(){g("",this,"string")}}},lab_orders:{doctor_id:"",doctor_name:"",data:[],"new":{show:!1,result:"",toggleShow:function(){this.show=!this.show},reset:function(){g("",this,"string")}}},services:{type:"",data:[],"new":{show:!1,medical_service_id:"",medical_service_name:"",toggleShow:function(){this.show=!this.show},reset:function(){g("",this,"string")}}},reset:function(){g("",this,"string"),g("",this.icd,"string"),g("",this.prescriptions,"string"),this.prescriptions.new.show=!1,this.prescriptions.data.length=0,g("",this.lab_orders,"string"),this.lab_orders.new.show=!1,this.lab_orders.data.length=0,g("",this.services,"string"),this.services.new.show=!1,this.services.data.length=0}},b.edit={toggle:!1,visit_date:"",outcome:"",patient_id:"",patient_name:"",icd:{code:"",id:""},prescriptions:{doctor_id:"",doctor_name:"",data:[],"new":{show:!1,drug_id:"",drug_name:"",quantity:"",dose:"",notice:"",toggleShow:function(){this.show=!this.show},reset:function(){g("",this,"string")}}},lab_orders:{doctor_id:"",doctor_name:"",data:[],"new":{show:!1,result:"",toggleShow:function(){this.show=!this.show},reset:function(){g("",this,"string")}}},services:{type:"",data:[],"new":{show:!1,medical_service_id:"",medical_service_name:"",toggleShow:function(){this.show=!this.show},reset:function(){g("",this,"string")}}},reset:function(){g("",this,"string"),g("",this.icd,"string"),g("",this.prescriptions,"string"),this.prescriptions.new.show=!1,this.prescriptions.data.length=0,g("",this.lab_orders,"string"),this.lab_orders.new.show=!1,this.lab_orders.data.length=0,g("",this.services,"string"),this.services.new.show=!1,this.services.data.length=0}},b.enter=function(a){a.reset(),a.toggleShow()},b.input=function(a){var c=h(a.new,"string");c.editMode=!1,a.data.push(c),b.enter(a.new)},b.typeaheadOnSelect=function(a,b,c){a[b]=c.id.toString()};var k=e.defer(),l=e.defer(),m=e.defer(),n=e.defer(),o=e.defer();b.getPatients=function(a){return i("patient_lookup",a,k)},b.getDoctors=function(a){return i("doctor_lookup",a,l)},b.getDrugs=function(a){return i("drug_lookup",a,m)},b.getMedicalServices=function(a){return i("medical_service_lookup",a,n)},b.getICDs=function(a){return i("icd_lookup",a,o)},b.deleteElement=function(a,d,e){c.confirm("Delete this row ?",function(c){c&&(a.splice(d,e),b.$apply())})},b.createSubmit=function(){var a=[];b.create.prescriptions.data.forEach(function(b){a.push({drug_id:b.drug_id,drug_name:b.drug_name,quantity:b.quantity,dose:b.dose,notice:b.notice})});var c=[];b.create.lab_orders.data.forEach(function(a){c.push({result:a.result})});var d=[];b.create.services.data.forEach(function(a){d.push({medical_service_id:a.medical_service_id,medical_service_name:a.medical_service_name})}),f.send({type:"medical_history_handler",method:"create",elements:[{visit_date:b.create.visit_date,outcome:b.create.outcome,patient_id:b.create.patient_id,patient_name:b.create.patient_name,icd:{id:b.create.icd.id,code:b.create.icd.code},prescriptions:{doctor_id:b.create.prescriptions.doctor_id,doctor_name:b.create.prescriptions.doctor_name,data:a},lab_orders:{doctor_id:b.create.lab_orders.doctor_id,doctor_name:b.create.lab_orders.doctor_name,data:c},services:{service_type:b.create.services.type,data:d}}]}),b.create.toggle=!1,b.create.reset()},b.filter=function(){},b.toPage=function(a){f.send({type:"medical_history_handler",method:""==b.query?"query":"filter",page:a,max:j,keyword:b.query})},f.registerCallBack(function(a){var c=JSON.parse(a);if("medical_history_handler"==c.type)switch(c.method){case"query":b.noElements=c.noElements,b.medicalHistories=c.elements;break;case"create":b.medicalHistories.unshift(c.elements[0]);break;case"update":break;case"filter":break;case"delete":break;case"patient_lookup":k.resolve(c.elements),k=e.defer();break;case"doctor_lookup":l.resolve(c.elements),l=e.defer();break;case"drug_lookup":m.resolve(c.elements),m=e.defer();break;case"medical_service_lookup":n.resolve(c.elements),n=e.defer();break;case"icd_lookup":o.resolve(c.elements),o=e.defer()}b.$apply()}),f.send({type:"medical_history_handler",method:"query",page:1,max:j})}])});